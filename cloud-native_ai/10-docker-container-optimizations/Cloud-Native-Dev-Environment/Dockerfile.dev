FROM python:3.11 

WORKDIR /app

# Single COPY: grabs everything at once.
# Problem: if you change main.py, Docker invalidates this layer AND every
# layer after it - including the expensive `uv pip install` below.
# That means a full dependency reinstall on every code change.
COPY . .

# Install uv + dependencies (re-runs on ANY file change because of COPY above)
RUN pip install --no-cache-dir uv && uv pip install --system --no-cache -r pyproject.toml

EXPOSE 8000

CMD ["uvicorn", "main:app", "--reload", "--host", "0.0.0.0", "--port", "8000"]